{% extends "admin/base_admin.html" %}

{% block title %}Detalhes do Pedido #{{ pedido.numero }} - Painel Admin{% endblock %}

{% block content %}
<div class="admin-header">
    <div>
        <h1><i class="fas fa-shopping-cart"></i> Pedido #{{ pedido.numero }}</h1>
        <p>Data: {{ pedido.data_pedido }}</p>
    </div>
    <a href="{{ url_for('admin_pedidos') }}" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Voltar
    </a>
</div>

<div class="admin-form-card">
    <h2 style="margin-bottom: 1.5rem;">Dados do Cliente</h2>
    <div class="form-row">
        <div class="form-group">
            <label>Nome</label>
            <p style="margin: 0; padding: 0.5rem; background: #f5f5f5; border-radius: 5px;">{{ pedido.nome }}</p>
        </div>
        <div class="form-group">
            <label>CPF</label>
            <p style="margin: 0; padding: 0.5rem; background: #f5f5f5; border-radius: 5px;">{{ pedido.cpf or '-' }}</p>
        </div>
    </div>
    
    <div class="form-row">
        <div class="form-group">
            <label>E-mail</label>
            <p style="margin: 0; padding: 0.5rem; background: #f5f5f5; border-radius: 5px;">{{ pedido.email }}</p>
        </div>
        <div class="form-group">
            <label>Telefone</label>
            <p style="margin: 0; padding: 0.5rem; background: #f5f5f5; border-radius: 5px;">{{ pedido.telefone }}</p>
        </div>
    </div>
    
    <div class="form-group">
        <label>Endereço</label>
        <p style="margin: 0; padding: 0.5rem; background: #f5f5f5; border-radius: 5px;">
            {{ pedido.endereco }}{% if pedido.cep %}, CEP: {{ pedido.cep }}{% endif %}<br>
            {% if pedido.cidade or pedido.estado %}{{ pedido.cidade }}{% if pedido.cidade and pedido.estado %}, {% endif %}{{ pedido.estado }}{% endif %}
        </p>
    </div>
</div>

<div class="admin-form-card" style="margin-top: 2rem;">
    <h2 style="margin-bottom: 1.5rem;">Itens do Pedido</h2>
    <div class="table-responsive">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Produto</th>
                    <th>Quantidade</th>
                    <th>Preço Unit.</th>
                    <th>Subtotal</th>
                </tr>
            </thead>
            <tbody>
                {% for item in pedido.itens %}
                <tr>
                    <td>
                        {% if item.produto_imagem %}
                        <img src="{{ item.produto_imagem }}" alt="{{ item.produto_nome }}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 5px; margin-right: 10px; vertical-align: middle;">
                        {% endif %}
                        {{ item.produto_nome }}
                    </td>
                    <td>{{ item.quantidade }}</td>
                    <td>R$ {{ "%.2f"|format(item.preco_unitario) }}</td>
                    <td><strong>R$ {{ "%.2f"|format(item.subtotal) }}</strong></td>
                </tr>
                {% endfor %}
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="3" style="text-align: right;"><strong>Total:</strong></td>
                    <td><strong style="font-size: 1.2rem; color: var(--primary-color);">R$ {{ "%.2f"|format(pedido.total) }}</strong></td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>

<div class="admin-form-card" style="margin-top: 2rem;">
    <h2 style="margin-bottom: 1.5rem;">Atualizar Status</h2>
    <form method="POST" action="{{ url_for('admin_atualizar_status_pedido', pedido_id=pedido.id) }}">
        <div class="form-group">
            <label for="status">Status do Pedido</label>
            <select id="status" name="status" class="form-control">
                <option value="pendente" {% if pedido.status == 'pendente' %}selected{% endif %}>Pendente</option>
                <option value="processando" {% if pedido.status == 'processando' %}selected{% endif %}>Processando</option>
                <option value="enviado" {% if pedido.status == 'enviado' %}selected{% endif %}>Enviado</option>
                <option value="entregue" {% if pedido.status == 'entregue' %}selected{% endif %}>Entregue</option>
                <option value="cancelado" {% if pedido.status == 'cancelado' %}selected{% endif %}>Cancelado</option>
            </select>
        </div>
        <div class="form-actions">
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i> Atualizar Status
            </button>
        </div>
    </form>
</div>
{% endblock %}

