{% extends "base.html" %}

{% block title %}{{ produto.nome }} - Loja Clínica do Reparo{% endblock %}

{% block description %}{{ produto.descricao[:160] if produto.descricao else produto.nome }}{% endblock %}

{% block content %}
<section class="page-header">
    <div class="container">
        <nav style="margin-bottom: 1rem; font-size: 0.9rem;">
            <a href="{{ url_for('loja') }}" style="color: var(--text-secondary); text-decoration: none;">Loja</a>
            <span style="margin: 0 0.5rem; color: var(--text-secondary);">/</span>
            {% if produto.categoria_nome %}
            <a href="{{ url_for('loja', categoria=produto.categoria_id) }}" style="color: var(--text-secondary); text-decoration: none;">{{ produto.categoria_nome }}</a>
            <span style="margin: 0 0.5rem; color: var(--text-secondary);">/</span>
            {% endif %}
            <span style="color: var(--text-primary);">{{ produto.nome }}</span>
        </nav>
        <h1>{{ produto.nome }}</h1>
    </div>
</section>

<section class="produto-detalhes-section" style="padding: 4rem 0;">
    <div class="container">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 3rem; margin-bottom: 3rem;">
            <div class="produto-imagem" style="background: white; border-radius: 10px; padding: 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                <img src="{{ url_for('static', filename=produto.imagem) if not produto.imagem.startswith('/admin/') else produto.imagem }}" 
                     alt="{{ produto.nome }}" 
                     style="width: 100%; height: auto; border-radius: 5px;"
                     onerror="this.src='{{ url_for('static', filename='img/placeholder.png') }}'">
            </div>
            
            <div class="produto-info-detalhes">
                {% if produto.categoria_nome %}
                <span style="font-size: 0.9rem; color: var(--primary-color); text-transform: uppercase; font-weight: 600;">{{ produto.categoria_nome }}</span>
                {% endif %}
                
                <h2 style="margin: 1rem 0; font-size: 2rem; color: var(--text-primary);">{{ produto.nome }}</h2>
                
                {% if produto.marca %}
                <p style="font-size: 1.1rem; color: var(--text-secondary); margin-bottom: 1rem;">
                    <strong>Marca:</strong> {{ produto.marca }}
                    {% if produto.modelo %}
                    <br><strong>Modelo:</strong> {{ produto.modelo }}
                    {% endif %}
                </p>
                {% endif %}
                
                {% if produto.sku %}
                <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem;">
                    <strong>SKU:</strong> {{ produto.sku }}
                </p>
                {% endif %}
                
                <div class="produto-preco" style="margin: 2rem 0; padding: 1.5rem; background: #f8f9fa; border-radius: 10px;">
                    {% if produto.preco_promocional %}
                    <span style="text-decoration: line-through; color: #999; font-size: 1.2rem; display: block; margin-bottom: 0.5rem;">R$ {{ "%.2f"|format(produto.preco) }}</span>
                    <span style="color: var(--primary-color); font-size: 2.5rem; font-weight: bold;">R$ {{ "%.2f"|format(produto.preco_promocional) }}</span>
                    {% else %}
                    <span style="color: var(--primary-color); font-size: 2.5rem; font-weight: bold;">R$ {{ "%.2f"|format(produto.preco) }}</span>
                    {% endif %}
                </div>
                
                {% if produto.estoque <= 0 %}
                <div style="padding: 1rem; background: #fee; border: 1px solid #e74c3c; border-radius: 5px; margin-bottom: 1.5rem;">
                    <p style="color: #e74c3c; margin: 0;"><i class="fas fa-exclamation-circle"></i> Produto fora de estoque</p>
                </div>
                {% elif produto.estoque < 5 %}
                <div style="padding: 1rem; background: #fff3cd; border: 1px solid #f39c12; border-radius: 5px; margin-bottom: 1.5rem;">
                    <p style="color: #f39c12; margin: 0;"><i class="fas fa-exclamation-triangle"></i> Últimas unidades disponíveis!</p>
                </div>
                {% else %}
                <div style="padding: 1rem; background: #d4edda; border: 1px solid #28a745; border-radius: 5px; margin-bottom: 1.5rem;">
                    <p style="color: #28a745; margin: 0;"><i class="fas fa-check-circle"></i> Em estoque</p>
                </div>
                {% endif %}
                
                <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                    <input type="number" id="quantidade" value="1" min="1" max="{{ produto.estoque }}" 
                           style="width: 100px; padding: 0.75rem; border: 1px solid #ddd; border-radius: 5px; text-align: center;"
                           {{ 'disabled' if produto.estoque <= 0 else '' }}>
                    <button onclick="adicionarAoCarrinho({{ produto.id }})" 
                            class="btn btn-primary" 
                            style="flex: 1; padding: 0.75rem 1.5rem;"
                            {{ 'disabled' if produto.estoque <= 0 else '' }}>
                        <i class="fas fa-shopping-cart"></i> Adicionar ao Carrinho
                    </button>
                </div>
                
                {% if produto.peso or produto.dimensoes %}
                <div style="margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #eee;">
                    <h3 style="font-size: 1.2rem; margin-bottom: 1rem;">Especificações</h3>
                    {% if produto.peso %}
                    <p style="margin: 0.5rem 0;"><strong>Peso:</strong> {{ "%.2f"|format(produto.peso) }} kg</p>
                    {% endif %}
                    {% if produto.dimensoes %}
                    <p style="margin: 0.5rem 0;"><strong>Dimensões:</strong> {{ produto.dimensoes }}</p>
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
        
        {% if produto.descricao_completa or produto.descricao %}
        <div class="produto-descricao" style="background: white; border-radius: 10px; padding: 2rem; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h3 style="font-size: 1.5rem; margin-bottom: 1.5rem;">Descrição do Produto</h3>
            <div style="line-height: 1.8; color: var(--text-secondary);">
                {% if produto.descricao_completa %}
                {{ produto.descricao_completa|safe }}
                {% else %}
                <p>{{ produto.descricao }}</p>
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
function adicionarAoCarrinho(produtoId) {
    const quantidade = parseInt(document.getElementById('quantidade').value) || 1;
    
    const formData = new FormData();
    formData.append('produto_id', produtoId);
    formData.append('quantidade', quantidade);
    
    fetch('{{ url_for("adicionar_carrinho") }}', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            const cartCount = document.getElementById('cart-count');
            if (cartCount) {
                cartCount.textContent = data.total_itens || 0;
            }
            alert('Produto adicionado ao carrinho!');
        } else {
            alert(data.message || 'Erro ao adicionar produto ao carrinho');
        }
    })
    .catch(error => {
        console.error('Erro:', error);
        alert('Erro ao adicionar produto ao carrinho');
    });
}

document.addEventListener('DOMContentLoaded', function() {
    const carrinho = {{ session.get('carrinho', [])|tojson }};
    const totalItens = carrinho.reduce((sum, item) => sum + (item.quantidade || 1), 0);
    const cartCount = document.getElementById('cart-count');
    if (cartCount) {
        cartCount.textContent = totalItens;
    }
});
</script>
{% endblock %}

